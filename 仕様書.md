# Twimodo - 一人用ツイッターもどき

## 基本仕様

### データストレージ
- 投稿データはローカルのSQLiteデータベースに保存
- Node.jsを使用してデータベース操作を実行
- 画像ファイルは`uploads/`ディレクトリに保存

### 投稿機能
- **Webインターフェース**: ブラウザから投稿可能（推奨方法）
- **コマンドライン**: CLI経由でも投稿可能
- **画像添付**: 最大4枚の画像を添付可能（JPEG/PNG、1枚につき最大5MB）

### HTML生成
- 投稿後に自動でHTMLファイルを生成し`public/`以下に保存
- タイムライン表示用の`index.html`
- 各投稿の個別ページ`post-{id}.html`

### 共有機能
- 各投稿に固有のURL（`post-{id}.html`）
- いいねやリツイート機能は無し
- シンプルなURL共有のみ対応

## 利用方法

### Webサーバー起動
```bash
npm start
# または
node index.js server
```
- 投稿フォーム: `http://localhost:3000` (自動でpost.htmlにリダイレクト)
- タイムライン: `http://localhost:3000/timeline`

### 投稿フォーム機能
- **ドラッグ&ドロップ対応**: 画像をドラッグして簡単アップロード
- **リアルタイムプレビュー**: 選択した画像をすぐに確認
- **文字数カウンター**: 280文字制限をリアルタイム表示
- **画像管理**: 個別削除ボタン付き（最大4枚）
- **バリデーション**: ファイルサイズ・形式チェック
- **レスポンシブデザイン**: スマホでも使いやすい

### CLI操作
```bash
# テキスト投稿
node index.js post "投稿内容"

# 投稿一覧表示
node index.js list

# HTML再生成
node index.js generate

# データベースマイグレーション
npm run migrate
```

## 技術仕様

### アーキテクチャ
- **Webサーバー**: Express.js（静的ファイル配信・API）
- **データベース**: SQLite3（自動マイグレーション対応）
- **ファイルアップロード**: Multer（最大4枚、5MB制限）
- **HTMLテンプレート**: テンプレートエンジン対応（Mustache風記法）
- **フロントエンド**: バニラJS（ドラッグ&ドロップ、プレビュー機能）
- **静的ファイル生成**: 画像自動コピー（`public/images/`）

### ファイル構成
```
twimodo/
├── 仕様書.md           # プロジェクト仕様書
├── index.js            # メインCLI
├── migrate.js          # データベースマイグレーション
├── package.json        # 依存関係・スクリプト
├── src/
│   ├── database.js     # SQLite操作
│   ├── htmlGenerator.js # HTML生成・テンプレート処理
│   └── server.js       # Express.jsサーバー
├── templates/          # HTMLテンプレート
│   ├── base.html       # 共通レイアウト
│   ├── timeline.html   # タイムライン表示
│   └── post.html       # 個別投稿表示
├── uploads/            # アップロード画像（元ファイル）
├── database/           # SQLiteデータベース
└── public/             # 生成される静的ファイル
    ├── post.html       # 投稿フォーム（手動作成）
    ├── index.html      # タイムライン（自動生成）
    ├── post-*.html     # 個別投稿（自動生成）
    └── images/         # 静的配信用画像（自動コピー）
```

### データベーススキーマ
```sql
CREATE TABLE posts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    content TEXT NOT NULL,
    images TEXT,  -- JSON配列形式で画像ファイル名を保存
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### テンプレートシステム
- **テンプレート記法**: Mustache風（`{{変数}}`, `{{#配列}}...{{/配列}}`）
- **base.html**: 共通レイアウト・CSS・ナビゲーション
- **timeline.html**: 投稿一覧表示テンプレート
- **post.html**: 個別投稿表示テンプレート

## 実装完了機能

### ✅ 完成済み機能
- [ ]  SQLiteデータベースでの投稿管理
- [ ]  画像アップロード機能（最大4枚、5MB制限）
- [ ]  Webベース投稿フォーム（ドラッグ&ドロップ対応）
- [ ]  リアルタイム画像プレビュー・個別削除
- [ ]  文字数制限（280文字・リアルタイム表示）
- [ ]  HTMLファイル自動生成（テンプレート式）
- [ ]  個別投稿ページ（URL共有）
- [ ]  タイムライン表示
- [ ]  CLI投稿機能
- [ ]  レスポンシブデザイン（モバイル対応）
- [ ]  自動データベースマイグレーション
- [ ]  画像の自動コピー（`public/images/`）
- [ ]  投稿フォーム保護（生成除外）
- [ ]  テンプレートシステム（保守性向上）

### 🛠️ 技術改善点
- **テンプレート化**: 埋込み式HTMLから独立テンプレートファイルへ移行
- **画像管理**: `uploads/` → `public/images/` への自動コピー機能
- **投稿フォーム**: 高機能UI（プレビュー・バリデーション・レスポンシブ）
- **マイグレーション**: 既存データを保持したスキーマ更新

### 🎯 動作確認済み
- ✅ 画像付き投稿の作成・表示が正常動作
- ✅ ドラッグ&ドロップでの画像アップロード
- ✅ 投稿後の自動HTML再生成
- ✅ モバイル対応のレスポンシブUI
- ✅ 静的ファイルとしての完全動作
- ✅ CLI・Web両方からの投稿


